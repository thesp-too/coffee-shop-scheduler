<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®è¿ç§»å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #8B4513;
            margin-bottom: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }
        .btn-primary {
            background: #8B4513;
            color: white;
        }
        .btn-secondary {
            background: #3498db;
            color: white;
        }
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ å’–å•¡åº—æ’ç­ç³»ç»Ÿ - æ•°æ®è¿ç§»å·¥å…·</h1>
        
        <div class="section info">
            <h3>â„¹ï¸ è¯´æ˜</h3>
            <p>è¿™ä¸ªå·¥å…·å¸®åŠ©æ‚¨åœ¨ <strong>file://</strong> åè®®å’Œ <strong>http://localhost:8080</strong> ä¹‹é—´è¿ç§»æ•°æ®ã€‚</p>
            <p>localStorage æ˜¯æ ¹æ®åè®®éš”ç¦»çš„ï¼Œæ‰€ä»¥ç›´æ¥æ‰“å¼€ index.html å’Œé€šè¿‡æœåŠ¡å™¨è®¿é—®çš„æ•°æ®æ˜¯åˆ†å¼€çš„ã€‚</p>
        </div>

        <div class="section">
            <h3>ğŸ“Š å½“å‰æ•°æ®çŠ¶æ€</h3>
            <div id="dataStatus"></div>
        </div>

        <div class="section">
            <h3>ğŸ“¥ å¯¼å‡ºå½“å‰æ•°æ®</h3>
            <p>å¯¼å‡ºå½“å‰åè®®ä¸‹çš„æ‰€æœ‰æ•°æ®åˆ° JSON æ–‡ä»¶ï¼š</p>
            <button class="btn btn-primary" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
            <div id="exportStatus"></div>
        </div>

        <div class="section">
            <h3>ğŸ“¤ å¯¼å…¥æ•°æ®</h3>
            <p>ä» JSON æ–‡ä»¶å¯¼å…¥æ•°æ®åˆ°å½“å‰åè®®ï¼š</p>
            <input type="file" id="importFile" accept=".json" style="margin: 10px 0;">
            <br>
            <button class="btn btn-secondary" onclick="importData()">å¯¼å…¥æ•°æ®</button>
            <div id="importStatus"></div>
        </div>

        <div class="section">
            <h3>ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</h3>
            <p>æ¸…ç©ºå½“å‰åè®®ä¸‹çš„æ‰€æœ‰æ•°æ®ï¼š</p>
            <button class="btn btn-success" onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
            <div id="clearStatus"></div>
        </div>

        <div class="section warning">
            <h3>âš ï¸ ä½¿ç”¨å»ºè®®</h3>
            <ol>
                <li>å¦‚æœæ‚¨ä¹‹å‰ç›´æ¥æ‰“å¼€ index.html ä½¿ç”¨ï¼Œè¯·å…ˆç‚¹å‡»"å¯¼å‡ºæ•°æ®"ä¿å­˜æ•°æ®</li>
                <li>ç„¶åè®¿é—® http://localhost:8080 ä½¿ç”¨è¿™ä¸ªå·¥å…·å¯¼å…¥æ•°æ®</li>
                <li>æˆ–è€…ç›´æ¥åœ¨ http://localhost:8080 ä¸Šé‡æ–°å¼€å§‹ä½¿ç”¨</li>
            </ol>
        </div>
    </div>

    <script>
        const KEYS = {
            EMPLOYEES: 'coffee_shop_employees',
            SHIFTS: 'coffee_shop_shifts',
            SCHEDULES: 'coffee_shop_schedules',
            STORES: 'coffee_shop_stores',
            INITIALIZED: 'coffee_shop_initialized'
        };

        function getData() {
            return {
                employees: JSON.parse(localStorage.getItem(KEYS.EMPLOYEES) || '[]'),
                shifts: JSON.parse(localStorage.getItem(KEYS.SHIFTS) || '[]'),
                schedules: JSON.parse(localStorage.getItem(KEYS.SCHEDULES) || '{}'),
                stores: JSON.parse(localStorage.getItem(KEYS.STORES) || '[]'),
                initialized: localStorage.getItem(KEYS.INITIALIZED) === 'true'
            };
        }

        function showDataStatus() {
            const data = getData();
            const status = document.getElementById('dataStatus');
            
            status.innerHTML = `
                <p><strong>å½“å‰åè®®:</strong> ${window.location.protocol}</p>
                <p><strong>å½“å‰ä¸»æœº:</strong> ${window.location.host}</p>
                <p><strong>å‘˜å·¥æ•°é‡:</strong> ${data.employees.length}</p>
                <p><strong>ç­æ¬¡æ•°é‡:</strong> ${data.shifts.length}</p>
                <p><strong>åˆ†åº—æ•°é‡:</strong> ${data.stores.length}</p>
                <p><strong>æ’ç­è®°å½•:</strong> ${Object.keys(data.schedules).length} å¤©</p>
                <p><strong>å·²åˆå§‹åŒ–:</strong> ${data.initialized ? 'æ˜¯' : 'å¦'}</p>
            `;
        }

        function exportData() {
            const data = getData();
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                protocol: window.location.protocol,
                host: window.location.host,
                ...data
            };
            
            const jsonStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `coffee-shop-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            document.getElementById('exportStatus').innerHTML = 
                '<div class="status success">âœ… æ•°æ®å¯¼å‡ºæˆåŠŸï¼</div>';
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                document.getElementById('importStatus').innerHTML = 
                    '<div class="status warning">âš ï¸ è¯·å…ˆé€‰æ‹©æ–‡ä»¶</div>';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // å¯¼å…¥æ•°æ®
                    if (data.employees) {
                        localStorage.setItem(KEYS.EMPLOYEES, JSON.stringify(data.employees));
                    }
                    if (data.shifts) {
                        localStorage.setItem(KEYS.SHIFTS, JSON.stringify(data.shifts));
                    }
                    if (data.schedules) {
                        localStorage.setItem(KEYS.SCHEDULES, JSON.stringify(data.schedules));
                    }
                    if (data.stores) {
                        localStorage.setItem(KEYS.STORES, JSON.stringify(data.stores));
                    }
                    if (data.initialized) {
                        localStorage.setItem(KEYS.INITIALIZED, 'true');
                    }
                    
                    document.getElementById('importStatus').innerHTML = 
                        '<div class="status success">âœ… æ•°æ®å¯¼å…¥æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°...</div>';
                    
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } catch (error) {
                    document.getElementById('importStatus').innerHTML = 
                        '<div class="status warning">âŒ å¯¼å…¥å¤±è´¥ï¼š' + error.message + '</div>';
                }
            };
            reader.readAsText(file);
        }

        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem(KEYS.EMPLOYEES);
                localStorage.removeItem(KEYS.SHIFTS);
                localStorage.removeItem(KEYS.SCHEDULES);
                localStorage.removeItem(KEYS.STORES);
                localStorage.removeItem(KEYS.INITIALIZED);
                
                document.getElementById('clearStatus').innerHTML = 
                    '<div class="status success">âœ… æ•°æ®å·²æ¸…ç©ºï¼é¡µé¢å°†åˆ·æ–°...</div>';
                
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ•°æ®çŠ¶æ€
        showDataStatus();
    </script>
</body>
</html>
